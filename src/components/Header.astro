---
import { LOGO_IMAGE, SITE } from "@config";
import LinkButton from "./LinkButton.astro";

export interface Props {
  activeNav?:
    | "about"
    | "services"
    | "portfolio"
    | "things-i-do"
    | "blog"
    | "posts"
    | "tags"
    | "search";
}

const { activeNav } = Astro.props;
---

<header class="header">
  <div class="nav-container">
    <div class="top-nav-wrap">
      <a href="https://www.michalprzadka.com" class="logo">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          id="Layer_1"
          version="1.1"
          viewBox="0 0 489.7 227.6"
          class="brand-logo"
          ><path
            d="M77.9,4.9h12.4l15.4,45.8h.5L122.8,4.9h12.2v86.1h-10V28h-.5l-18.1,48.2h-1.2l-16.9-48.6h-.5v63.3h-10V4.9Z"
            class="path-5"></path><path
            d="M221.4,59.7c0-19.6,9.7-32.6,28.4-32.6s25,10,25.8,22.6h-10.3c-.6-8.4-6.4-13.4-15.5-13.4-12.9,0-18,10.5-18,23.4s5,23.4,18,23.4,14.9-4.8,15.7-13.2h10.3c-1.2,13.3-9.6,22.3-26,22.3s-28.5-12.7-28.5-32.5Z"
            class="path-6"></path><path
            d="M293.9,0h10.3v38h.5c3.3-6.4,9.5-10.9,19.2-10.9,13.9,0,22.3,8.7,22.3,23.1v40.8h-10.3v-39.2c0-9.8-4.8-15.5-14.8-15.5s-16.9,7.6-16.9,20.3v34.4h-10.3V0Z"
            class="path-7"></path><path
            d="M365.6,72.7c0-10.6,7.5-19.7,26-19.7h15.5v-4.1c0-7-4.3-13-14.5-13s-13.8,5.2-13.9,11.2h-10c0-12.1,10.1-20,23.9-20s24.6,9.7,24.6,21.6v42.3h-8.7l-.7-8.9h-.5c-3.8,6.4-10.8,10-19.7,10-13.7,0-21.9-8.5-21.9-19.4ZM407,66.7v-5.4h-15.5c-10.2,0-15.5,3.9-15.5,11.3s4.2,10.9,13.3,10.9,17.7-7.7,17.7-16.9Z"
            class="path-8"></path><path
            d="M0,114.9h28c17.6,0,27.2,11.2,27.2,27.2s-9.8,27.7-27.2,27.7H10.7v31.2H0v-86.1ZM26.7,159.9c11.9,0,17.5-6.3,17.5-17.8s-5.9-17.5-17.5-17.5h-16v35.3h16Z"
            class="path-9"></path><path
            d="M147.4,192.5l35.8-45.1v-.5h-35.7v-8.7h47.8v8.6l-35.7,45v.5h35.9v8.7h-48.2v-8.5Z"
            class="path-10"></path><path
            d="M256.8,213c0,4.2,3.2,5.8,6.5,5.8h3.9v8.9h-6.2c-7.6,0-14.1-4.6-14.1-12.4s6.1-13,11.4-15.6l-.6-7.4h-.5c-3.8,6.4-10.8,10-19.7,10-13.7,0-21.9-8.5-21.9-19.4s7.5-19.7,26-19.7h15.5v-4.1c0-7-4.3-13-14.5-13s-13.8,5.2-13.9,11.2h-10c0-12.1,10.1-20,23.9-20s24.6,9.7,24.6,21.6v42.3c-4.7,2.2-10.5,5.9-10.5,11.9ZM257.2,171.3h-15.5c-10.2,0-15.5,3.9-15.5,11.3s4.2,10.9,13.3,10.9,17.7-7.7,17.7-16.9v-5.4Z"
            class="path-11"></path><path
            d="M289.3,169.5c.1-18.6,9-32.5,26.7-32.5s15.6,4.3,18.9,9.8h.5v-36.9h10.3v91h-9l-1.4-8.7h-.5c-3.3,5.5-9.6,9.8-18.9,9.8-16.5,0-26.8-12.3-26.7-32.6ZM335.7,169.5c0-12.4-5.4-23.2-18-23.2s-18,10.7-18,23.2,4.9,23.4,18,23.4,18-10.8,18-23.4Z"
            class="path-12"></path><path
            d="M380.3,110v91h-10.3v-91h10.3ZM419.8,199.8v1.2h-11.9l-27.6-35.3,26.6-27.6h12.2v1.2l-25.5,26.3,26.2,34.1Z"
            class="path-13"></path><path
            d="M434.3,182.7c0-10.6,7.5-19.7,26-19.7h15.5v-4.1c0-7-4.3-13-14.5-13s-13.8,5.2-13.9,11.2h-10c0-12.1,10.1-20,23.9-20s24.6,9.7,24.6,21.6v42.3h-8.7l-.7-8.9h-.5c-3.8,6.4-10.8,10-19.7,10-13.7,0-21.9-8.5-21.9-19.4ZM475.8,176.7v-5.4h-15.5c-10.2,0-15.5,3.9-15.5,11.3s4.2,10.9,13.3,10.9,17.7-7.7,17.7-16.9Z"
            class="path-14"></path><rect
            y="82.4"
            width="54.1"
            height="8.7"
            fill="currentcolor"
            class="st0-2 animate-blink"></rect><g class="g-5"
            ><rect x="172.8" y="3.1" width="11.6" height="12.1" class="rect-3"
            ></rect><polygon
              points="173.4 73.7 183.8 73.7 183.8 28.2 152.4 28.2 152.4 36.8 173.4 36.8 173.4 73.7"
              class="polygon-2"></polygon><rect
              x="150.3"
              y="82.4"
              width="54.1"
              height="8.6"
              class="rect-4"></rect></g
          ><g class="g-6"
            ><polygon
              points="454.6 82.4 454.6 82.4 435.6 82.4 435.6 91 489.7 91 489.7 82.4 454.6 82.4"
              class="polygon-3"></polygon><polygon
              points="457.4 73.7 467.8 73.7 467.8 0 437.6 0 437.6 8.6 457.4 8.6 457.4 73.7"
              class="polygon-4"></polygon></g
          ><g class="g-7"
            ><path
              d="M88.6,183.7h10.3v-13.2c0-14.8,5.4-23.1,17.3-23.1h11.1v-10h-11.8c-7.7,0-14,4.3-16.6,11.3h-.5l-.9-10.6h-25.1v8.6h16.1v37Z"
              class="path-15"></path><rect
              x="70.4"
              y="192.4"
              width="56.6"
              height="8.6"
              class="rect-5"></rect></g
          ><path
            d="M467.2,32.5l-26.2,10.4v9.5h1.2l25-9.8M467.1,42.6l16.6-6.5v-9.7h-1.2l-15.4,6.2"
            class="path-16"></path></svg
        >
      </a>
      <nav id="nav-menu">
        <button
          class="hamburger-menu focus-outline"
          aria-label="Open Menu"
          aria-expanded="false"
          aria-controls="menu-items"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="menu-icon"
          >
            <line x1="0" y1="6" x2="28" y2="6" class="line"></line>
            <line x1="0" y1="12" x2="28" y2="12" class="line"></line>
            <line x1="0" y1="18" x2="28" y2="18" class="line"></line>
            <!-- <line x1="18" y1="6" x2="6" y2="18" class="close"></line>
            <line x1="6" y1="6" x2="18" y2="18" class="close"></line> -->
          </svg>
        </button>
        <div class="menu-wrapper">
          <ul id="menu-items" class="">
            <li>
              <a
                href="https://www.michalprzadka.com/about"
                class={activeNav === "about" ? "active" : ""}
              >
                about me
              </a>
            </li>
            <li>
              <a
                href="https://www.michalprzadka.com/services"
                class={activeNav === "services" ? "active" : ""}
              >
                services
              </a>
            </li>
            <li>
              <a
                href="https://www.michalprzadka.com/portfolio"
                class={activeNav === "portfolio" ? "active" : ""}
              >
                portfolio
              </a>
            </li>
            <li>
              <a
                href="https://www.michalprzadka.com/things-i-do"
                class={activeNav === "things-i-do" ? "active" : ""}
              >
                things i do
              </a>
            </li>
            <li>
              <a href="/" class={activeNav === "blog" ? "active" : ""}>
                blog
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>

<style>
  .nav-container {
    @apply mx-auto flex max-w-full flex-col items-center justify-between sm:flex-row;
  }
  .top-nav-wrap {
    @apply relative flex w-full items-center justify-between p-6 sm:items-center sm:px-12 sm:py-6;
  }
  .logo {
    @apply flex min-h-[60px] w-[106px] min-w-[100px] flex-col items-start justify-center text-2xl font-light tracking-wider transition-all hover:scale-[0.98] hover:opacity-85;
  }
  .brand-logo {
    @apply h-full w-full text-skin-accent-muted;
  }
  .hamburger-menu {
    @apply self-end p-2 sm:hidden;
  }
  .hamburger-menu svg {
    @apply h-6 w-6 scale-125 fill-skin-base;
  }

  nav {
    @apply flex w-full flex-col items-center sm:flex-row sm:justify-end sm:space-x-4 sm:py-0;
  }
  nav ul {
    @apply mt-4 grid w-full max-sm:relative max-sm:rounded-2xl max-sm:bg-skin-fill max-sm:p-5 sm:mt-0 sm:flex sm:w-auto sm:flex-row sm:gap-[40px];
  }
  nav ul li {
    @apply flex items-center max-sm:h-[56px] sm:justify-center;
  }
  nav ul li a {
    @apply w-full text-xl tracking-[.22px] transition-all duration-300 sm:m-0 sm:px-2 sm:py-1.5 sm:text-center;
  }

  nav ul li a:hover {
    -webkit-text-stroke: 1px rgb(var(--color-text-base));
  }

  @media (max-width: 640px) {
    .menu-wrapper {
      @apply pointer-events-none fixed left-0 top-[72px] z-10 w-full -translate-y-full p-5 opacity-0 transition-all duration-[400ms] ease-in-out;
    }
    .menu-wrapper.show {
      @apply pointer-events-auto visible translate-y-0 opacity-100;
    }

    nav ul {
      box-shadow: 1px 1px 20px #402e321a;
    }
  }
  .header {
    @apply fixed left-0 right-0 top-0 z-20 bg-skin-fill transition-transform duration-500;
  }
</style>

<script>
  let lastScrollY = window.scrollY;

  function hideHeaderOnScroll() {
    const header = document.querySelector(".header") as HTMLElement;
    if (!header) return;

    const currentScrollY = window.scrollY;

    if (currentScrollY > lastScrollY) {
      // Scrolling down
      header.style.transform = "translateY(-100%)";
    } else {
      // Scrolling up
      header.style.transform = "translateY(0)";
    }

    lastScrollY = currentScrollY;
  }

  // Add scroll event listener
  window.addEventListener("scroll", hideHeaderOnScroll);

  function toggleNav() {
    // Toggle menu
    const menuBtn = document.querySelector(".hamburger-menu");
    const menuIcon = document.querySelector(".menu-icon");
    const menuItems = document.querySelector("#menu-items");
    const menuWrapper = document.querySelector(".menu-wrapper");

    // Close menu when clicking outside
    document.addEventListener("click", e => {
      const target = e.target as HTMLElement;
      const isMenuBtn = target.closest(".hamburger-menu");
      const isMenuItems = target.closest("#menu-items");

      if (!isMenuBtn && !isMenuItems && menuItems?.classList.contains("show")) {
        menuIcon?.classList.remove("is-active");
        menuBtn?.setAttribute("aria-expanded", "false");
        menuBtn?.setAttribute("aria-label", "Open Menu");
        menuItems?.classList.remove("show");
        menuWrapper?.classList.remove("show");
      }
    });

    menuBtn?.addEventListener("click", e => {
      e.stopPropagation(); // Prevent the document click handler from immediately closing the menu
      const menuExpanded = menuBtn.getAttribute("aria-expanded") === "true";
      menuIcon?.classList.toggle("is-active");
      menuBtn.setAttribute("aria-expanded", menuExpanded ? "false" : "true");
      menuBtn.setAttribute(
        "aria-label",
        menuExpanded ? "Open Menu" : "Close Menu"
      );
      menuItems?.classList.toggle("show");
      menuWrapper?.classList.toggle("show");
    });
  }

  toggleNav();

  // Runs on view transitions navigation
  document.addEventListener("astro:after-swap", () => {
    toggleNav();
    lastScrollY = window.scrollY;
  });
</script>
